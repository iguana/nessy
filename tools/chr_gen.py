#!/usr/bin/env python3
"""Generate 8KB CHR-ROM with printable ASCII font (0x20-0x7F) in NES 2bpp planar format."""

import sys
import os

# 8x8 pixel font bitmaps for printable ASCII (0x20 - 0x7F = 96 characters)
# Each character is 8 rows, each row is 8 pixels (1 bit per pixel, plane 0 only)
FONT = {
    0x20: [0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00],  # space
    0x21: [0x18,0x18,0x18,0x18,0x18,0x00,0x18,0x00],  # !
    0x22: [0x6C,0x6C,0x6C,0x00,0x00,0x00,0x00,0x00],  # "
    0x23: [0x6C,0xFE,0x6C,0x6C,0xFE,0x6C,0x00,0x00],  # #
    0x24: [0x18,0x7E,0xC0,0x7C,0x06,0xFC,0x18,0x00],  # $
    0x25: [0xC6,0xCC,0x18,0x30,0x66,0xC6,0x00,0x00],  # %
    0x26: [0x38,0x6C,0x38,0x76,0xDC,0xCC,0x76,0x00],  # &
    0x27: [0x18,0x18,0x30,0x00,0x00,0x00,0x00,0x00],  # '
    0x28: [0x0C,0x18,0x30,0x30,0x30,0x18,0x0C,0x00],  # (
    0x29: [0x30,0x18,0x0C,0x0C,0x0C,0x18,0x30,0x00],  # )
    0x2A: [0x00,0x66,0x3C,0xFF,0x3C,0x66,0x00,0x00],  # *
    0x2B: [0x00,0x18,0x18,0x7E,0x18,0x18,0x00,0x00],  # +
    0x2C: [0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x30],  # ,
    0x2D: [0x00,0x00,0x00,0x7E,0x00,0x00,0x00,0x00],  # -
    0x2E: [0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00],  # .
    0x2F: [0x06,0x0C,0x18,0x30,0x60,0xC0,0x00,0x00],  # /
    0x30: [0x7C,0xC6,0xCE,0xD6,0xE6,0xC6,0x7C,0x00],  # 0
    0x31: [0x18,0x38,0x18,0x18,0x18,0x18,0x7E,0x00],  # 1
    0x32: [0x7C,0xC6,0x06,0x1C,0x70,0xC6,0xFE,0x00],  # 2
    0x33: [0x7C,0xC6,0x06,0x3C,0x06,0xC6,0x7C,0x00],  # 3
    0x34: [0x1C,0x3C,0x6C,0xCC,0xFE,0x0C,0x0C,0x00],  # 4
    0x35: [0xFE,0xC0,0xFC,0x06,0x06,0xC6,0x7C,0x00],  # 5
    0x36: [0x3C,0x60,0xC0,0xFC,0xC6,0xC6,0x7C,0x00],  # 6
    0x37: [0xFE,0xC6,0x0C,0x18,0x30,0x30,0x30,0x00],  # 7
    0x38: [0x7C,0xC6,0xC6,0x7C,0xC6,0xC6,0x7C,0x00],  # 8
    0x39: [0x7C,0xC6,0xC6,0x7E,0x06,0x0C,0x78,0x00],  # 9
    0x3A: [0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x00],  # :
    0x3B: [0x00,0x18,0x18,0x00,0x00,0x18,0x18,0x30],  # ;
    0x3C: [0x0C,0x18,0x30,0x60,0x30,0x18,0x0C,0x00],  # <
    0x3D: [0x00,0x00,0x7E,0x00,0x7E,0x00,0x00,0x00],  # =
    0x3E: [0x60,0x30,0x18,0x0C,0x18,0x30,0x60,0x00],  # >
    0x3F: [0x7C,0xC6,0x0C,0x18,0x18,0x00,0x18,0x00],  # ?
    0x40: [0x7C,0xC6,0xDE,0xDE,0xDE,0xC0,0x7C,0x00],  # @
    0x41: [0x38,0x6C,0xC6,0xC6,0xFE,0xC6,0xC6,0x00],  # A
    0x42: [0xFC,0xC6,0xC6,0xFC,0xC6,0xC6,0xFC,0x00],  # B
    0x43: [0x7C,0xC6,0xC0,0xC0,0xC0,0xC6,0x7C,0x00],  # C
    0x44: [0xF8,0xCC,0xC6,0xC6,0xC6,0xCC,0xF8,0x00],  # D
    0x45: [0xFE,0xC0,0xC0,0xFC,0xC0,0xC0,0xFE,0x00],  # E
    0x46: [0xFE,0xC0,0xC0,0xFC,0xC0,0xC0,0xC0,0x00],  # F
    0x47: [0x7C,0xC6,0xC0,0xCE,0xC6,0xC6,0x7E,0x00],  # G
    0x48: [0xC6,0xC6,0xC6,0xFE,0xC6,0xC6,0xC6,0x00],  # H
    0x49: [0x7E,0x18,0x18,0x18,0x18,0x18,0x7E,0x00],  # I
    0x4A: [0x1E,0x06,0x06,0x06,0xC6,0xC6,0x7C,0x00],  # J
    0x4B: [0xC6,0xCC,0xD8,0xF0,0xD8,0xCC,0xC6,0x00],  # K
    0x4C: [0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xFE,0x00],  # L
    0x4D: [0xC6,0xEE,0xFE,0xD6,0xC6,0xC6,0xC6,0x00],  # M
    0x4E: [0xC6,0xE6,0xF6,0xDE,0xCE,0xC6,0xC6,0x00],  # N
    0x4F: [0x7C,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00],  # O
    0x50: [0xFC,0xC6,0xC6,0xFC,0xC0,0xC0,0xC0,0x00],  # P
    0x51: [0x7C,0xC6,0xC6,0xC6,0xD6,0xDE,0x7C,0x06],  # Q
    0x52: [0xFC,0xC6,0xC6,0xFC,0xD8,0xCC,0xC6,0x00],  # R
    0x53: [0x7C,0xC6,0xC0,0x7C,0x06,0xC6,0x7C,0x00],  # S
    0x54: [0xFE,0x18,0x18,0x18,0x18,0x18,0x18,0x00],  # T
    0x55: [0xC6,0xC6,0xC6,0xC6,0xC6,0xC6,0x7C,0x00],  # U
    0x56: [0xC6,0xC6,0xC6,0xC6,0x6C,0x38,0x10,0x00],  # V
    0x57: [0xC6,0xC6,0xC6,0xD6,0xFE,0xEE,0xC6,0x00],  # W
    0x58: [0xC6,0x6C,0x38,0x38,0x6C,0xC6,0xC6,0x00],  # X  (fixed: was wrong)
    0x59: [0xC6,0xC6,0x6C,0x38,0x18,0x18,0x18,0x00],  # Y
    0x5A: [0xFE,0x06,0x0C,0x18,0x30,0x60,0xFE,0x00],  # Z
    0x5B: [0x3C,0x30,0x30,0x30,0x30,0x30,0x3C,0x00],  # [
    0x5C: [0xC0,0x60,0x30,0x18,0x0C,0x06,0x00,0x00],  # backslash
    0x5D: [0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x3C,0x00],  # ]
    0x5E: [0x10,0x38,0x6C,0xC6,0x00,0x00,0x00,0x00],  # ^
    0x5F: [0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x00],  # _
    0x60: [0x30,0x18,0x0C,0x00,0x00,0x00,0x00,0x00],  # `
    0x61: [0x00,0x00,0x7C,0x06,0x7E,0xC6,0x7E,0x00],  # a
    0x62: [0xC0,0xC0,0xFC,0xC6,0xC6,0xC6,0xFC,0x00],  # b
    0x63: [0x00,0x00,0x7C,0xC6,0xC0,0xC6,0x7C,0x00],  # c
    0x64: [0x06,0x06,0x7E,0xC6,0xC6,0xC6,0x7E,0x00],  # d
    0x65: [0x00,0x00,0x7C,0xC6,0xFE,0xC0,0x7C,0x00],  # e
    0x66: [0x1C,0x36,0x30,0x7C,0x30,0x30,0x30,0x00],  # f
    0x67: [0x00,0x00,0x7E,0xC6,0xC6,0x7E,0x06,0x7C],  # g
    0x68: [0xC0,0xC0,0xFC,0xC6,0xC6,0xC6,0xC6,0x00],  # h
    0x69: [0x18,0x00,0x38,0x18,0x18,0x18,0x3C,0x00],  # i
    0x6A: [0x0C,0x00,0x1C,0x0C,0x0C,0xCC,0xCC,0x78],  # j
    0x6B: [0xC0,0xC0,0xCC,0xD8,0xF0,0xD8,0xCC,0x00],  # k
    0x6C: [0x38,0x18,0x18,0x18,0x18,0x18,0x3C,0x00],  # l
    0x6D: [0x00,0x00,0xCC,0xFE,0xD6,0xC6,0xC6,0x00],  # m
    0x6E: [0x00,0x00,0xFC,0xC6,0xC6,0xC6,0xC6,0x00],  # n
    0x6F: [0x00,0x00,0x7C,0xC6,0xC6,0xC6,0x7C,0x00],  # o
    0x70: [0x00,0x00,0xFC,0xC6,0xC6,0xFC,0xC0,0xC0],  # p
    0x71: [0x00,0x00,0x7E,0xC6,0xC6,0x7E,0x06,0x06],  # q
    0x72: [0x00,0x00,0xDC,0xE6,0xC0,0xC0,0xC0,0x00],  # r
    0x73: [0x00,0x00,0x7E,0xC0,0x7C,0x06,0xFC,0x00],  # s
    0x74: [0x30,0x30,0x7C,0x30,0x30,0x36,0x1C,0x00],  # t
    0x75: [0x00,0x00,0xC6,0xC6,0xC6,0xC6,0x7E,0x00],  # u
    0x76: [0x00,0x00,0xC6,0xC6,0xC6,0x6C,0x38,0x00],  # v
    0x77: [0x00,0x00,0xC6,0xC6,0xD6,0xFE,0x6C,0x00],  # w
    0x78: [0x00,0x00,0xC6,0x6C,0x38,0x6C,0xC6,0x00],  # x
    0x79: [0x00,0x00,0xC6,0xC6,0xC6,0x7E,0x06,0x7C],  # y
    0x7A: [0x00,0x00,0xFE,0x0C,0x38,0x60,0xFE,0x00],  # z
    0x7B: [0x0E,0x18,0x18,0x70,0x18,0x18,0x0E,0x00],  # {
    0x7C: [0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x00],  # |
    0x7D: [0x70,0x18,0x18,0x0E,0x18,0x18,0x70,0x00],  # }
    0x7E: [0x76,0xDC,0x00,0x00,0x00,0x00,0x00,0x00],  # ~
}


def generate_chr(output_path):
    """Generate 8KB CHR-ROM file with ASCII font in NES 2bpp planar format."""
    chr_data = bytearray(8192)  # 512 tiles * 16 bytes = 8192

    for char_code in range(0x20, 0x80):
        tile_index = char_code - 0x20  # tile 0 = space (0x20)
        offset = tile_index * 16       # 16 bytes per tile

        if char_code in FONT:
            bitmap = FONT[char_code]
        else:
            bitmap = [0x00] * 8

        # NES 2bpp planar: 8 bytes plane 0, then 8 bytes plane 1
        # We use color 1 (plane 0 = bitmap, plane 1 = 0) for white-ish text
        for row in range(8):
            chr_data[offset + row] = bitmap[row]       # Plane 0
            chr_data[offset + 8 + row] = 0x00          # Plane 1 (all zero = color index 1)

    os.makedirs(os.path.dirname(output_path) or '.', exist_ok=True)
    with open(output_path, 'wb') as f:
        f.write(chr_data)

    print(f"Generated {output_path} ({len(chr_data)} bytes, {len(FONT)} glyphs)")


if __name__ == '__main__':
    out = sys.argv[1] if len(sys.argv) > 1 else 'chr/ascii.chr'
    generate_chr(out)
